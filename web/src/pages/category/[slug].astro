---
import { Markdown } from "astro/components"
import groq from "groq"
import sanityClient from "../../sanityClient"
import BaseLayout from "../../layouts/BaseLayout.astro"

export async function getStaticPaths() {
  const query = groq`*[_type == "category"] | order(title){
    _id,
    "posts": *[_type == "post" && references(^._id)]{title, slug},
    "slug": slug.current,
    title,
    _id
  }`
  const data = await sanityClient.fetch(query).then(response => response)
  return data.map(category => {
    return {
      params: { slug: category.slug },
      props: { category }
    }
  })
}

const { slug } = Astro.request.params
const { category } = Astro.props
---
<BaseLayout title={category.title}>
  <div>
    <h1>{category.title}</h1>
    <br>
    <h2>Posts</h2>
    <ul>
      {category.posts.map(item =>
        <li><a href=`/blog/${item.slug.current}`>{item.title}</a></li>
      )}
    </ul>
  </div>
</BaseLayout>

<!-- prettier-ignore -->
<style>

</style>
